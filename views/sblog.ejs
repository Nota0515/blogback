<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>
        <%= sblog.title %>
    </title>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs/themes/prism-tomorrow.min.css" />
    <link rel="stylesheet" href="/css/style.css">

</head>
<script src="https://cdn.jsdelivr.net/npm/prismjs/prism.js"></script>
<script src="https://cdn.jsdelivr.net/npm/prismjs/components/prism-javascript.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/prismjs/components/prism-css.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/prismjs/components/prism-markup.min.js"></script>


<body class="min-h-screen bg-[linear-gradient(180deg,rgba(26,26,26,1)_0%,rgba(0,0,0,1)_100%)]">
    <main class="flex-1">
        <article class="max-w-3xl mx-auto px-4 sm:px-6 py-10 sm:py-14">
            <!-- Breadcrumb / back -->
            <div class="mb-6 flex items-center gap-2 text-sm text-neutral-500">
                <a href="/blog" class="inline-flex items-center gap-1 hover:text-neutral-200 transition-colors">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-3.5 w-3.5" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                        <polyline points="15 18 9 12 15 6" />
                    </svg>
                    <span>All posts</span>
                </a>
            </div>

            <!-- Title + meta -->
            <header class="mb-10">
                <h1 class="text-3xl sm:text-4xl font-geist font-semibold tracking-tight text-neutral-50">
                    <%= sblog.title %>
                </h1>

                <div class="mt-4 flex flex-wrap items-center gap-3 text-sm text-neutral-500">
                    <span>
                        <%= new Date(sblog.created_at).toDateString() %>
                    </span>
                    <span class="h-1 w-1 rounded-full bg-neutral-700"></span>
                    <span id="like-container"
                        class="relative flex items-center gap-1 cursor-pointer select-none text-neutral-400 hover:text-neutral-200 transition-colors">
                        <svg id="like-icon" xmlns="http://www.w3.org/2000/svg" width="18" height="18"
                            viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="0.8"
                            stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-clover">
                            <path d="M16.17 7.83 2 22" />
                            <path
                                d="M4.02 12a2.827 2.827 0 1 1 3.81-4.17A2.827 2.827 0 1 1 12 4.02a2.827 2.827 0 1 1 4.17 3.81A2.827 2.827 0 1 1 19.98 12a2.827 2.827 0 1 1-3.81 4.17A2.827 2.827 0 1 1 12 19.98a2.827 2.827 0 1 1-4.17-3.81A1 1 0 1 1 4 12" />
                            <path d="m7.83 7.83 8.34 8.34" />
                        </svg>
                        <span id="like-count">
                            <%= sblog.like_count %>
                        </span> Clovers
                    </span>
                </div>
            </header>

            <!-- sblog Content -->
            <section class="prose font-geist prose-invert max-w-none">
                <%- sblog.htmlContent %>
            </section>
        </article>
    </main>


    <script>
        const likeContainer = document.getElementById("like-container");
        const likeIcon = document.getElementById("like-icon");
        const likeCount = document.getElementById("like-count");

        function showBurst() {
            const burst = document.createElement("div");
            burst.className = "like-burst";
            burst.textContent = "+1";
            likeContainer.appendChild(burst);
            setTimeout(() => {
                burst.remove();
            }, 600);
        }

        likeContainer.addEventListener("click", async () => {
            if (likeContainer.dataset.clicked) return;

            try {
                const res = await fetch(`/api/v1/blog/<%= sblog.slug %>/like`, { method: "POST" });
                const data = await res.json();

                if (data.success) {
                    likeCount.textContent = Number(likeCount.textContent) + 1;
                    likeContainer.dataset.clicked = true;
                    showBurst();
                } else if (data.message === "already liked") {
                    likeContainer.dataset.clicked = true;
                    showBurst();
                }
            } catch (err) {
                console.error("Like failed", err);
            }
        });
    </script>

</body>

</html>